<!DOCTYPE html>      
<html> 
<head>
  <title>Προγράμματα για Collatz</title>
  <link rel="stylesheet" href="Collatz.css">
</head>

<body>
  <h1>Ακολουθία χαλαζιού</h1>
  <p>Τυπώνει την ακολουθία των αριθμών που προκύπτουν με HOTPO.</p>
  
  <p>
  Δώστε έναν θετικό ακέραιο αριθμό:
  <input type="text" id="numb">
  <button type="button" onclick="myWrapper()">Submit</button>
  </p>

  <canvas id="myCanvas" style="border:1px solid #000000;"></canvas>   
  <p>Μήκος ακολουθίας:  <span id="lenseq"></span></p>
  <p>Μέγιστος ακολουθίας: <span id="maxseq"></span></p>
  <p>Ακολουθία χαλαζιού: <span id="colseq"></span></p>
  
<script>

function myWrapper() {
  var n = document.getElementById("numb").value; //Get value of input field
  if (isNaN(n) || n < 1)     //Check input validity
    document.getElementById("colseq").innerHTML = "Μη έγκυρη είσοδος";
  else {
    document.getElementById("colseq").innerHTML = h(n);
	var t1 = t(n);
	document.getElementById("lenseq").innerHTML = t1;
	var m1 = m(n);
    document.getElementById("maxseq").innerHTML = m1;
	drawCanvas(n, t1, m1);
  } 
  
}

function f(n) {
  //HOTPO function
  if (n % 2 == 0)
    return n/2;
  else
    return 3*n+1;
}

function h(n) {
  //Hailstone sequence
  var seq = n + "";
  while (n > 1) {
    n = f(n);
    seq = seq + " " + n;
  }
  return seq;
}

function t(n) {
  //Collatz number
  var len = 0;
  while (n > 1) {
    n = f(n); 
    len++;
  }
  return len;
}

function m(n) {
  //maximum of sequence
  var max = n;
  while (n > 1) {
    n = f(n); 
    if (n > max) max = n;
  }
  return max;
}

function drawCanvas(n, t, m){
  var c = document.getElementById("myCanvas");
  var ctx = c.getContext("2d");
  ctx.canvas.width  = window.innerWidth - 50;
  ctx.canvas.height = window.innerHeight - 300;

  ctx.clearRect(0, 0, c.width, c.height);
  
  //axis values
  ctx.font = "12px Arial";
  ctx.strokeText("(0,0)", 0, c.height-1);
  ctx.strokeText(m, 0, 12);
  ctx.strokeText(t, c.width-20, c.height-1);
  
  ctx.fillStyle="#FF0000" //for fillRect
  ctx.strokeStyle = "#00FF00" //for lineTo
  var xscale = c.width / t;
  var yscale = c.height / m;  
  var dot = 3; //rectangle size
  if (n > 999) dot = 2;
  if (n > 9999) dot = 1;  
  
  
  ctx.beginPath(); //for line
  ctx.moveTo(0, c.height-n*yscale-1); //wrong
  for (var i=0; i<=t; i++) {  
	ctx.fillRect(i*xscale-1, c.height-n*yscale-1, dot, dot);
	ctx.lineTo(i*xscale, c.height-n*yscale);
	n = f(n);
  }
  ctx.stroke(); //draw line
}

</script>
  
</body>
</html>
